{
  "rules": [
    {
      "name": "MT103_STP_Mandatory_Fields",
      "description": "Validate that all mandatory fields are present",
      "logic": {
        "and": [
          {"exists": ["fields", "20"]},
          {"exists": ["fields", "23B"]},
          {"exists": ["fields", "32A"]},
          {"exists": ["fields", "50"]},
          {"exists": ["fields", "59"]},
          {"exists": ["fields", "71A"]}
        ]
      }
    },
    {
      "name": "MT103_STP_Field_20_Format",
      "description": "Field 20 must not start or end with '/', no '//' allowed",
      "logic": {
        "and": [
          {"!": {"==": [{"substr": [{"var": "fields.20.transaction_reference"}, 0, 1]}, "/"]}},
          {"!": {"==": [{"substr": [{"var": "fields.20.transaction_reference"}, -1]}, "/"]}},
          {"!": {"in": ["//" , {"var": "fields.20.transaction_reference"}]}}
        ]
      }
    },
    {
      "name": "MT103_STP_Field_23B_Valid_Codes",
      "description": "Field 23B must contain valid bank operation codes",
      "logic": {
        "in": [
          {"var": "fields.23B.bank_operation_code"},
          ["CRED", "CRTS", "SPAY", "SPRI", "SSTD"]
        ]
      }
    },
    {
      "name": "MT103_STP_Field_71A_Valid_Codes",
      "description": "Field 71A must contain valid charge codes",
      "logic": {
        "in": [
          {"var": "fields.71A.details_of_charges"},
          ["OUR", "SHA", "BEN"]
        ]
      }
    },
    {
      "name": "MT103_STP_C1_Exchange_Rate_Rule",
      "description": "C1: If 33B currency differs from 32A, then 36 must be present",
      "logic": {
        "if": [
          {"and": [
            {"exists": ["fields", "33B"]},
            {"!": {"==": [{"var": "fields.33B.currency"}, {"var": "fields.32A.currency"}]}}
          ]},
          {"exists": ["fields", "36"]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C1_No_Exchange_Rate_Rule",
      "description": "C1: If 33B currency matches 32A, then 36 must not be present",
      "logic": {
        "if": [
          {"and": [
            {"exists": ["fields", "33B"]},
            {"==": [{"var": "fields.33B.currency"}, {"var": "fields.32A.currency"}]}
          ]},
          {"!": {"exists": ["fields", "36"]}},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C3_SPRI_Instruction_Code",
      "description": "C3: If 23B = SPRI, 23E can only contain SDVA or INTC",
      "logic": {
        "if": [
          {"==": [{"var": "fields.23B.bank_operation_code"}, "SPRI"]},
          {
            "if": [
              {"exists": ["fields", "23E"]},
              {"in": [{"var": "fields.23E.instruction_code"}, ["SDVA", "INTC"]]},
              true
            ]
          },
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C3_SSTD_SPAY_No_Instruction",
      "description": "C3: If 23B = SSTD or SPAY, 23E must not be present",
      "logic": {
        "if": [
          {"in": [{"var": "fields.23B.bank_operation_code"}, ["SSTD", "SPAY"]]},
          {"!": {"exists": ["fields", "23E"]}},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C4_Correspondent_Chain",
      "description": "C4: If 55A is present, both 53A and 54A become mandatory",
      "logic": {
        "if": [
          {"exists": ["fields", "55A"]},
          {"and": [{"exists": ["fields", "53A"]}, {"exists": ["fields", "54A"]}]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C5_Intermediary_Account_With",
      "description": "C5: If 56A is present, 57A becomes mandatory",
      "logic": {
        "if": [
          {"exists": ["fields", "56A"]},
          {"exists": ["fields", "57A"]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C6_SPRI_No_Intermediary",
      "description": "C6: If 23B = SPRI, 56A is not allowed",
      "logic": {
        "if": [
          {"==": [{"var": "fields.23B.bank_operation_code"}, "SPRI"]},
          {"!": {"exists": ["fields", "56A"]}},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C7_OUR_Charges",
      "description": "C7: If 71A = OUR, 71F is not allowed",
      "logic": {
        "if": [
          {"==": [{"var": "fields.71A.details_of_charges"}, "OUR"]},
          {"!": {"exists": ["fields", "71F"]}},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C7_SHA_Charges",
      "description": "C7: If 71A = SHA, 71G is not allowed",
      "logic": {
        "if": [
          {"==": [{"var": "fields.71A.details_of_charges"}, "SHA"]},
          {"!": {"exists": ["fields", "71G"]}},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C7_BEN_Charges_Required",
      "description": "C7: If 71A = BEN, 71F is mandatory",
      "logic": {
        "if": [
          {"==": [{"var": "fields.71A.details_of_charges"}, "BEN"]},
          {"exists": ["fields", "71F"]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C7_BEN_No_Receiver_Charges",
      "description": "C7: If 71A = BEN, 71G is not allowed",
      "logic": {
        "if": [
          {"==": [{"var": "fields.71A.details_of_charges"}, "BEN"]},
          {"!": {"exists": ["fields", "71G"]}},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C8_Charges_Require_33B",
      "description": "C8: If 71F or 71G present, 33B becomes mandatory",
      "logic": {
        "if": [
          {"or": [{"exists": ["fields", "71F"]}, {"exists": ["fields", "71G"]}]},
          {"exists": ["fields", "33B"]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_C9_Receiver_Charges_Currency",
      "description": "C9: Currency code in 71G must match 32A",
      "logic": {
        "if": [
          {"exists": ["fields", "71G"]},
          {"==": [{"var": "fields.71G.currency"}, {"var": "fields.32A.currency"}]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_Amount_Positive",
      "description": "Amount in 32A must be positive",
      "logic": {
        ">": [{"var": "fields.32A.amount"}, 0]
      }
    },
    {
      "name": "MT103_STP_Valid_Currency_Codes",
      "description": "Currency codes must be valid ISO 4217",
      "logic": {
        "and": [
          {"==": [{"length": [{"var": "fields.32A.currency"}]}, 3]},
          {
            "if": [
              {"exists": ["fields", "33B"]},
              {"==": [{"length": [{"var": "fields.33B.currency"}]}, 3]},
              true
            ]
          },
          {
            "if": [
              {"exists": ["fields", "71F"]},
              {"==": [{"length": [{"var": "fields.71F.currency"}]}, 3]},
              true
            ]
          },
          {
            "if": [
              {"exists": ["fields", "71G"]},
              {"==": [{"length": [{"var": "fields.71G.currency"}]}, 3]},
              true
            ]
          }
        ]
      }
    },
    {
      "name": "MT103_STP_Field_72_No_REJT_RETN",
      "description": "Field 72 must not contain REJT or RETN codes",
      "logic": {
        "if": [
          {"exists": ["fields", "72"]},
          {"and": [
            {"!": {"in": ["REJT", {"var": "fields.72.information"}]}},
            {"!": {"in": ["RETN", {"var": "fields.72.information"}]}}
          ]},
          true
        ]
      }
    },
    {
      "name": "MT103_STP_Reference_Length",
      "description": "Transaction reference must not exceed 16 characters",
      "logic": {
        "<=": [{"length": [{"var": "fields.20.transaction_reference"}]}, 16]
      }
    },
    {
      "name": "MT103_STP_Amount_Format",
      "description": "Amount must be positive and properly formatted",
      "logic": {
        ">": [{"var": "fields.32A.amount"}, 0]
      }
    }
  ]
} 